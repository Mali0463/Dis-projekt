<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leder Feedback</title>
    <link rel="stylesheet" href="/css/Feedback.css">
</head>
<body>
    <h1>Manage Feedback</h1>

    <label for="feedbackRecipient">Vælg medarbejder:</label>
    <select id="feedbackRecipient">
        <!-- Medarbejdere tilføjes dynamisk -->
    </select>

    <textarea id="feedbackText" placeholder="Skriv din feedback her..."></textarea>
    <button id="giveFeedbackButton">Giv Feedback</button>

    <h2>Eksisterende Feedback</h2>
    <div id="feedback-container">
        <!-- Feedback vises her -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            await loadEmployees();
            await loadFeedback();
        });

        // Hent medarbejderliste
        async function loadEmployees() {
            try {
                const response = await fetch('/employees');
                if (response.ok) {
                    const employees = await response.json();
                    const recipientSelect = document.getElementById('feedbackRecipient');
                    employees.forEach(employee => {
                        const option = document.createElement('option');
                        option.value = employee.email;
                        option.textContent = employee.email;
                        recipientSelect.appendChild(option);
                    });
                } else {
                    alert('Kunne ikke hente medarbejdere.');
                }
            } catch (err) {
                console.error('Fejl under hentning af medarbejdere:', err);
            }
        }

        // Tilføj feedback
        document.getElementById('giveFeedbackButton').addEventListener('click', async () => {
            const recipientEmail = document.getElementById('feedbackRecipient').value;
            const feedbackText = document.getElementById('feedbackText').value.trim();

            if (!recipientEmail || !feedbackText) {
                alert('Vælg en medarbejder og skriv feedback.');
                return;
            }

            try {
                const response = await fetch('/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ recipient_email: recipientEmail, feedback: feedbackText })
                });
                if (response.ok) {
                    alert('Feedback givet!');
                    document.getElementById('feedbackText').value = '';
                    await loadFeedback();
                } else {
                    alert('Kunne ikke sende feedback.');
                }
            } catch (err) {
                console.error('Fejl ved feedback:', err);
            }
        });

        // Hent og vis feedback
        async function loadFeedback() {
            try {
                const response = await fetch('/feedback/user');
                if (response.ok) {
                    const feedbacks = await response.json();
                    const container = document.getElementById('feedback-container');
                    container.innerHTML = '';

                    feedbacks.forEach(item => {
                        const feedbackDiv = document.createElement('div');
                        feedbackDiv.innerHTML = `
                            <p>${item.feedback}</p>
                            <button onclick="deleteFeedback(${item.id})">Slet</button>
                        `;
                        container.appendChild(feedbackDiv);
                    });
                } else {
                    alert('Kunne ikke hente feedback.');
                }
            } catch (err) {
                console.error('Fejl under hentning af feedback:', err);
            }
        }

        // Slet feedback
        async function deleteFeedback(id) {
            try {
                const response = await fetch(`/feedback/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    alert('Feedback slettet!');
                    await loadFeedback();
                } else {
                    alert('Kunne ikke slette feedback.');
                }
            } catch (err) {
                console.error('Fejl under sletning:', err);
            }
        }
    </script>
</body>
</html>
